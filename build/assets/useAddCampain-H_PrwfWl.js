import{a as A,d as u}from"./campain.interface-D7tnG7AQ.js";import{u as C}from"./form-DTWdmFFU.js";import{u as f}from"./Step5-Cf5D64WC.js";import{r as s}from"./app-lUInwgRy.js";import{g as O,s as E}from"./localstorage-CJtMg3ae.js";const _=["payment_method","company_street","company_city","company_zone","company_code_postal","company_country","company_tax_number","company_commercial_register","company_financial_officer_email","company_financial_officer_phone"],q=a=>{const y=f(t=>t.tabHandler),d=f(t=>t.tab),[o,g]=s.useState(null),[i,m]=s.useState(!0);console.log(a),s.useEffect(()=>{a?m(!1):(async()=>{try{const e=O("lastCampaignStep5Data");e&&g(e)}catch(e){console.warn("Failed to load last campaign data:",e)}finally{m(!1)}})()},[a]);const S=()=>{if(a)return{...u,...a,campain_date:{from:new Date(String(a.campain_start_date)),to:new Date(String(a.campain_end_date))},influencer_wilaya:Array.isArray(JSON.parse(a.influencer_wilaya))?JSON.parse(a.influencer_wilaya):[a.influencer_wilaya],influencer_public_wilaya:Array.isArray(JSON.parse(a.influencer_public_wilaya))?JSON.parse(a.influencer_public_wilaya):[a.influencer_public_wilaya],campain_photos_required:Array.isArray(JSON.parse(a.campain_photos_required))?JSON.parse(a.campain_photos_required):[a.campain_photos_required],campain_social_media:typeof a.campain_social_media=="string"&&a.campain_social_media.startsWith("[")?JSON.parse(a.campain_social_media):[a.campain_social_media],company_tax_number:a.campany_tax_number,company_commercial_register:a.campany_commercial_register,company_financial_officer_email:a.campany_financial_officer_email,company_financial_officer_phone:a.campany_financial_officer_phone,company_street:a.campany_street,company_city:a.campany_city,company_zone:a.campany_zone,company_code_postal:a.campany_code_postal,company_country:a.campany_country};{const t={...u};return o&&_.forEach(e=>{o[e]!==void 0&&o[e]!==""&&(t[e]=o[e])}),t}},{handleSubmit:h,rhfForm:c,inertiaForm:l}=C({schema:A,defaultValues:S()});function D(t,e){console.log("Submitting campaign with values:",t);const r={};_.forEach(n=>{t[n]!==void 0&&t[n]!==""&&(r[n]=t[n])});try{E("lastCampaignStep5Data",r),console.log("Saved Step 5 data for future campaigns:",r)}catch(n){console.warn("Failed to save Step 5 data:",n)}let{campain_date:p,...L}=t;e.post("/client/submit-form",{data:{...L,campain_start_date:p.from,campain_end_date:p.to}})}const b=s.useRef(null),w=t=>{l.setData(t)};return s.useEffect(()=>{if(!i&&o&&!a){const t=c.getValues(),e={...t};_.forEach(r=>{o[r]!==void 0&&o[r]!==""&&(t[r]===""||t[r]===void 0)&&(e[r]=o[r])}),c.reset(e),console.log("Auto-loaded Step 5 data from previous campaign:",o)}},[i,o,a,c]),{onSubmit:D,handleSubmit:h,rhfForm:c,inertiaForm:l,tabHandler:y,tab:d,dataSetter:w,formRef:b,isLoadingLastData:i,hasAutoLoadedData:!!o}};export{q as u};
