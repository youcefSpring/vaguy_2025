import{q as W,r as c,$ as S,j as e,y as u,d as T}from"./app-lUInwgRy.js";import{B as x,b as I}from"./button-DzDbuX-O.js";import{I as $}from"./input-C7csDmVJ.js";import{T as X}from"./textarea--eRPwkRH.js";import{R as G,a as k,b as J,I as V,L as K,f as Q,T as C}from"./infinite-scroll-DtyaByy6.js";import{f as j}from"./date-cSGFDods.js";import{S as R}from"./scroll-area-Cz3DdDO6.js";import{L as Y}from"./label-BGTeFzqh.js";import{i as f}from"./utils-Cx_fVcGQ.js";import{I as g}from"./consts-CgVw4MgC.js";import{D as Z,a as v,b as ee}from"./dialog-BWYTjd7C.js";import{S as se}from"./search-BbkOGfC2.js";import{X as le}from"./x-D5Njf_z9.js";import{F as re}from"./file-BPGPrkov.js";/* empty css            */import"./createLucideIcon-BKiTtyiR.js";import"./format-B0DXPM4f.js";import"./index-CbDD-pNU.js";import"./index-DHkfiFuj.js";import"./index-DeDYDX0v.js";import"./index-x9bG2h8o.js";import"./index-BEk9yI-S.js";import"./index-B_8yjaaa.js";import"./index-CWdjyrzl.js";function Me({hasChat:l,conversations:t,conversation:s,count:i}){const{url:a}=W(),[d,B]=c.useState(""),[p,N]=c.useState(""),[n,o]=c.useState([]),D=r=>{B(r.target.value)},H=r=>{N(r.target.value)},b=c.useRef(null),U=r=>{const m=r.target.files||[];o([...n,...m])};c.useRef(null);const w=c.useRef(null);c.useEffect(()=>{const r=w.current,m=b.current;r&&m&&(a.includes("view")?m.focus():r.focus(),m.value="")},[]);const[E,y]=S.useState(!1),[_,O]=S.useState(Number(i)-Number(s==null?void 0:s.messages.length)>0),h=c.useRef(null),P=()=>{h.current&&h.current.scrollToTop()},q=()=>{h.current&&h.current.scrollToBottom()};return e.jsx("div",{className:"flex flex-col h__min__70",children:e.jsxs(G,{direction:"horizontal",className:"grid flex-1 grid-cols-2 border-t h__min__70",children:[e.jsx(k,{className:`overflow-scroll border-b border-l h__min__70 ${l?"md:block hidden":""}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("form",{className:"flex gap-0 p-4 border-b",onSubmit:r=>{r.preventDefault(),a.includes("view")?u.get(`/influencer/conversation/view/${s==null?void 0:s.id}?search=${d}`):u.get(`/influencer/conversation/influencers?search=${d}`)},children:[e.jsx(x,{type:"submit",variant:"outline",className:"rounded-tr-none rounded-br-none",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx($,{type:"search",className:"w-full max-w-sm text-sm rounded-tl-none rounded-bl-none",placeholder:"Search chats",value:d,onChange:D,ref:w})]}),e.jsx(R,{className:"flex-1 overflow-y-auto",children:e.jsx("ul",{className:"divide-y",children:t.map(r=>e.jsx(ie,{conversation:r,isClicked:r.id===(s==null?void 0:s.id)}))})})]})}),e.jsx(J,{}),e.jsxs(k,{className:`flex flex-col border-b border-r h__min__70 ${l?"":"md:block hidden "} `,children:[l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center p-4 space-x-4 border-b h-[72px] ",children:[e.jsx(x,{type:"button",className:"p-0 rounded-full",variant:"ghost",children:e.jsx(T,{className:"w-10 h-10 rounded-full",href:`/influencer/profile/${s==null?void 0:s.user.username}/${s==null?void 0:s.user.id}`,children:e.jsx("img",{alt:"User avatar",className:"rounded-full aspect-square",height:"40",src:s!=null&&s.user.image?`/assets/images/influencer/profile/${s==null?void 0:s.user.image}`:"/assets/user_profile.png",width:"40"})})}),e.jsx("h2",{className:"font-semibold",children:(s==null?void 0:s.user.firstname)+" "+(s==null?void 0:s.user.lastname)})]}),e.jsx(R,{className:"flex flex-col flex-1 w-full",ref:h,children:e.jsx("div",{className:"flex items-end justify-end flex-1 mt-auto messagerie",children:e.jsxs("div",{className:"flex flex-col items-end justify-end w-full gap-2 px-6 py-4 ",children:[e.jsx(V,{hasMore:_,isLoading:E,threshold:1,next:()=>{y(!0),u.get(`/influencer/conversation/view/${s==null?void 0:s.id}?more=${Number(s==null?void 0:s.messages.length)+10}`),y(!1);const r=Number(i)-Number(s==null?void 0:s.messages.length);O(r>0),P()},children:_&&e.jsx(K,{className:"w-8 h-8 my-4 animate-spin"})}),[...s==null?void 0:s.messages].reverse().map(r=>{switch(r.sender){case"influencer":return e.jsx(de,{message:r.message,time:String(r.created_at),read:!1,files:r.attachments?JSON.parse(r.attachments):[]},r.id);case"client":return e.jsx(L,{message:r.message,time:String(r.created_at),read:!1,files:r.attachments?JSON.parse(r.attachments):[]},r.id);default:return e.jsx(L,{message:r.message,time:String(r.created_at),read:!1},r.id)}})]})})})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(Q,{src:"https://lottie.host/30849ece-e0e3-4e48-8502-b2fe35128ef3/TS1hX0DOX8.json",background:"transparent",speed:1,style:{width:"350px",height:"350px"},loop:!0,autoplay:!0})}),e.jsxs("div",{className:"flex items-center p-4 space-x-4 border-t min-h-[120px]",children:[e.jsxs(Y,{htmlFor:"file","aria-label":"Attach file",className:I({variant:"ghost"})+"p-0 rounded-full relative w-6 h-6",children:[e.jsx($,{id:"file",type:"file",multiple:!0,onChange:U,className:"invisible w-0 h-0"}),e.jsx(te,{className:"absolute w-full h-full cursor-pointer"})]}),e.jsxs("div",{className:"flex flex-col flex-1 border-[1px] border-gray-600 rounded-md p-2",children:[e.jsx("div",{className:"flex gap-5",children:n.map((r,m)=>e.jsxs("div",{className:"group w-[60px] h-[60px] flex justify-center items-center hover:bg-primary-foreground",children:[e.jsx(x,{variant:"ghost",className:"hidden group-hover:block",onClick:()=>{o([...n].filter((me,z)=>z!==m))},children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("img",{src:URL.createObjectURL(r),alt:"img",className:"w-full h-full group-hover:hidden"},m)]}))}),e.jsx(X,{className:"flex-1 border-none focus-visible:ring-0 ",placeholder:"Type a message...",value:p,onChange:H,ref:b})]}),e.jsx(x,{type:"button","aria-label":"Send",className:"w-10 h-10",disabled:!p&&n.length===0,onClick:()=>{u.post(`/influencer/conversation/store/${s==null?void 0:s.id}`,{message:p,attachments:n||null}),N(""),o([]),q()},children:e.jsx(ae,{className:"w-4 h-4"})})]})]})]})},"1")}function ae(l){return e.jsxs("svg",{...l,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"m5 12 7-7 7 7"}),e.jsx("path",{d:"M12 19V5"})]})}function F(l){return e.jsx("svg",{...l,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}function te(l){return e.jsx("svg",{...l,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"})})}const ie=({conversation:l,isClicked:t})=>e.jsx("li",{className:"",children:e.jsxs(T,{className:`flex items-center p-4 space-x-4 duration-300 hover:bg-primary-foreground hover:text-black ${t?"bg-primary text-white":""}`,href:`/influencer/conversation/view/${l.id}`,children:[e.jsx("img",{alt:"User avatar",className:"rounded-full",height:"40",src:l!=null&&l.user.image?`/assets/images/influencer/profile/${l==null?void 0:l.user.image}`:"/assets/user_profile.png",style:{aspectRatio:"40/40",objectFit:"cover"},width:"40"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:l.user.firstname+" "+l.user.lastname}),e.jsx("p",{className:"text-sm truncate",children:l.last_message.message})]}),e.jsx("time",{className:"text-sm",children:j(String(l.last_message.created_at))})]})}),L=({message:l,read:t,time:s,files:i})=>e.jsxs("div",{className:"flex items-start w-full gap-4",children:[e.jsx("img",{alt:"User avatar",className:"rounded-full",height:"40",src:"/assets/user_profile.png",style:{aspectRatio:"40/40",objectFit:"cover"},width:"40"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`flex ${i.length>0?"my-3":""} items-center flex-col  `,children:i.filter(a=>!f(a)).map((a,d)=>e.jsx(A,{file:a,self:!1},a+d))}),e.jsx("div",{className:`flex ${i.length>0?"my-3":""} items-center gap-1 flex-wrap `,children:i.filter(a=>f(a)).map((a,d)=>e.jsx(M,{image:a,self:!1},a+d))}),e.jsxs("div",{className:"flex flex-col items-start justify-center gap-2",children:[l&&e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg dark:bg-gray-800 rounded-lg/none",children:e.jsx("p",{className:"text-sm",children:l})}),e.jsxs("time",{className:"flex items-center gap-1 text-xs",children:[t?e.jsx(F,{className:"w-4 h-4"}):e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:t?"read":j(String(s))})]})]})]})]}),de=({message:l,read:t,time:s,files:i})=>e.jsx("div",{className:"flex items-center justify-end w-full gap-4 ",children:e.jsxs("div",{className:"space-y-2 ",children:[e.jsx("div",{className:`flex ${i.length>0?"my-3":""} items-center flex-col  `,children:i.filter(a=>!f(a)).map((a,d)=>e.jsx(A,{file:a,self:!0},a+d))}),e.jsx("div",{className:`flex ${i.length>0?"my-3":""} items-center gap-1 flex-wrap `,children:i.filter(a=>f(a)).map((a,d)=>e.jsx(M,{image:a,self:!0},a+d))}),e.jsxs("div",{className:"flex flex-col items-end justify-center gap-2",children:[l&&e.jsx("div",{className:"p-4 font-normal text-right text-white rounded-lg bg-primary dark:bg-gray-800 rounded-lg/none w-fit ",children:e.jsx("p",{className:"text-sm",children:l})}),e.jsxs("time",{className:"flex items-center gap-1 text-xs",children:[t?e.jsx(F,{className:"w-4 h-4"}):e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:t?"read":j(String(s))})]})]})]})}),M=({image:l,self:t})=>e.jsx("div",{children:e.jsxs(Z,{children:[e.jsxs(v,{children:[" ",e.jsx("img",{src:g+"conversation/"+l,alt:"",className:`object-cover w-16 h-16 border-2 rounded-md aspect-square ${t?"border-primary":""} `})]}),e.jsx(ee,{children:e.jsx("img",{src:g+"conversation/"+l,alt:"",className:`object-cover mt-6 rounded-md aspect-square border-1 ${t?"border-primary":""}`})})]})}),A=({file:l,self:t})=>e.jsxs("a",{className:I({variant:"outline"})+`flex gap-2  
                ${t?"border-primary text-primary":""} `,href:g+"conversation/"+l,download:l,children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("p",{className:"text-sm font-medium leading-none",children:l})]});export{Me as default};
